<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="author" content="tan91">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&family=JetBrains+Mono:wght@400;700&family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f0f0f;
            --bg-panel: #1a1a1a;
            --accent: #ff6b00;
            --text-main: #e0e0e0;
            --text-dim: #555;
        }
        body { background-color: var(--bg-dark); color: var(--text-main); font-family: 'Noto Sans SC', sans-serif; overflow: hidden; }
        .font-eng { font-family: 'Chakra Petch', sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* 动态网格背景 */
        .perspective-grid {
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background-image: 
                linear-gradient(rgba(255, 107, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 107, 0, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            transform: perspective(500px) rotateX(60deg);
            animation: grid-move 20s linear infinite;
            z-index: -1;
            mask-image: radial-gradient(circle, black 0%, transparent 70%);
        }
        @keyframes grid-move {
            0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
            100% { transform: perspective(500px) rotateX(60deg) translateY(50px); }
        }

        /* 战术边框 (登录框专用) */
        .access-panel {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        .corner-accent {
            position: absolute;
            width: 10px;
            height: 10px;
            border: 2px solid var(--accent);
            transition: all 0.3s ease;
        }
        .c-tl { top: -1px; left: -1px; border-right: none; border-bottom: none; }
        .c-tr { top: -1px; right: -1px; border-left: none; border-bottom: none; }
        .c-bl { bottom: -1px; left: -1px; border-right: none; border-top: none; }
        .c-br { bottom: -1px; right: -1px; border-left: none; border-top: none; }

        /* 打字机光标 */
        .typing-cursor::after {
            content: '_';
            animation: blink 1s step-end infinite;
            color: var(--accent);
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* 输入框样式 */
        .tactical-input {
            background: #111;
            border: 1px solid #333;
            color: white;
            transition: all 0.3s;
        }
        .tactical-input:focus {
            outline: none;
            border-color: var(--accent);
            background: #000;
        }

        /* 扫描线 */
        .scan-line {
            width: 100%;
            height: 2px;
            background: rgba(255, 107, 0, 0.3);
            position: fixed;
            top: 0;
            z-index: 50;
            animation: scan 8s linear infinite;
            pointer-events: none;
        }
        @keyframes scan { 0% { top: -10%; } 100% { top: 110%; } }
    </style>
</head>
<body class="h-screen flex flex-col justify-center items-center relative">

    <!-- 背景特效 -->
    <div class="perspective-grid"></div>
    <div class="scan-line"></div>
    
    <!-- 顶部极简栏 -->
    <div class="absolute top-0 w-full p-6 flex justify-between items-center text-xs font-mono text-gray-500 z-10">
        <div class="flex items-center gap-2">
            <span class="w-2 h-2 bg-[#ff6b00]"></span>
            <span>SECURE_GATEWAY_V2.0</span>
        </div>
        <div>
            EST. 2020
        </div>
    </div>

    <!-- 主内容区：左侧文字 + 右侧登录框 -->
    <main class="container mx-auto px-6 flex flex-col lg:flex-row items-center justify-center gap-16 z-20">
        
        <!-- 左侧：品牌展示 -->
        <div class="text-center lg:text-left max-w-lg">
            <!-- LOGO -->
            <div class="inline-block bg-[#ff6b00] text-black font-black text-4xl px-4 py-1 font-eng tracking-tighter mb-6">
                TG
            </div>
            
            <h1 class="text-5xl md:text-7xl font-black text-white mb-6 leading-none tracking-tight">
                天格<span class="text-[#ff6b00]">.</span>
            </h1>
            
            <div class="space-y-2 mb-8">
                <p class="text-xl md:text-2xl text-white font-bold tracking-widest typing-cursor">天道酬勤 格物致知</p>
                <p class="text-sm text-gray-500 font-mono mt-2">
                    // INVESTIGATE THINGS TO EXTEND KNOWLEDGE
                </p>
            </div>

            <p class="text-gray-400 text-sm leading-relaxed mb-8 hidden lg:block border-l-2 border-[#333] pl-4">
                欢迎访问天格(TG)网络安全攻防演练平台。<br>
                此处为内部靶场接入端口，未授权人员请立即离开。<br>
                <span class="text-[#ff6b00] text-xs mt-2 block">WARNING: ALL ACTIVITIES ARE MONITORED.</span>
            </p>
        </div>

        <!-- 右侧：登录面板 (Access Panel) -->
        <div class="relative w-full max-w-md">
            <!-- 装饰性连接线 -->
            <div class="absolute -top-10 left-1/2 w-px h-10 bg-gradient-to-b from-transparent to-[#ff6b00] lg:hidden"></div>
            
            <div class="access-panel p-8 relative">
                <!-- 四个角的装饰 -->
                <div class="corner-accent c-tl"></div>
                <div class="corner-accent c-tr"></div>
                <div class="corner-accent c-bl"></div>
                <div class="corner-accent c-br"></div>

                <div class="text-center mb-8">
                    <h2 class="text-xl font-bold text-white font-eng tracking-widest">SYSTEM ACCESS</h2>
                    <p class="text-[10px] text-gray-500 font-mono mt-1">PLEASE IDENTIFY YOURSELF</p>
                </div>

                <!-- 登录表单 -->
                <form class="space-y-5" id="login-form">
                    <div>
                        <label class="block text-[10px] font-mono text-[#ff6b00] mb-1 uppercase tracking-wider">Codename // 用户名</label>
                        <input type="text" name="username" class="tactical-input w-full px-4 py-3 font-mono text-sm" placeholder="ENTER_USERNAME" required>
                    </div>
                    <div>
                        <label class="block text-[10px] font-mono text-[#ff6b00] mb-1 uppercase tracking-wider">Passcode // 密码</label>
                        <input type="password" name="password" class="tactical-input w-full px-4 py-3 font-mono text-sm" placeholder="••••••••" required>
                    </div>

                    <!-- 登录按钮 -->
                    <button type="submit" class="w-full bg-[#ff6b00] text-black font-bold py-3 uppercase tracking-widest hover:bg-white transition-colors text-sm shadow-[0_0_15px_rgba(255,107,0,0.4)]">
                        Verify & Login_
                    </button>
                    
                    <div class="flex justify-between items-center mt-4 text-[10px] font-mono">
                        <a href="#" class="text-gray-500 hover:text-white transition">FORGOT_PASS?</a>
                        <a href="#" class="text-[#ff6b00] border-b border-[#ff6b00] border-dashed hover:text-white hover:border-white transition pb-0.5">REGISTER_NEW_UNIT</a>
                    </div>
                </form>
                
                <!-- 底部状态条 -->
                <div class="mt-8 pt-4 border-t border-[#333] flex justify-between text-[10px] text-gray-600 font-mono" id="login-status">
                    <span>STATUS: WAITING_INPUT</span>
                    <span class="animate-pulse text-green-800">● SECURE</span>
                </div>
            </div>
        </div>
    </main>

    <!-- 底部版权 -->
    <footer class="absolute bottom-4 text-center z-20">
        <p class="text-base text-white font-bold font-mono tracking-[0.2em] uppercase mb-2" style="text-shadow: 0 0 10px rgba(255,255,255,0.5), 0 0 20px rgba(255,255,255,0.3);">
            Copyright © 2021-present tan91. All Rights Reserved.
        </p>
        <div class="flex justify-center gap-3">
            <a href="https://github.com/NUDTTAN91" target="_blank" class="px-3 py-1 bg-[#1a1a1a] border border-[#ff6b00] text-[#ff6b00] hover:bg-[#ff6b00] hover:text-black transition-colors text-[10px] font-mono flex items-center gap-1">
                <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
                GitHub
            </a>
            <a href="https://blog.csdn.net/ZXW_NUDT" target="_blank" class="px-3 py-1 bg-[#1a1a1a] border border-[#ff6b00] text-[#ff6b00] hover:bg-[#ff6b00] hover:text-black transition-colors text-[10px] font-mono flex items-center gap-1">
                <svg class="w-3 h-3" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                Blog
            </a>
        </div>
    </footer>

    <script>
        // 已登录检查：如果有token则跳转到home
        const existingToken = localStorage.getItem('tg_token');
        const mustChange = localStorage.getItem('tg_must_change_password');
        
        if (existingToken) {
            if (mustChange === 'true') {
                // 需要强制修改密码
                window.location.href = '/change-password.html';
            } else {
                window.location.href = '/home.html';
            }
        }

        const form = document.getElementById('login-form');
        const statusBar = document.getElementById('login-status');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const payload = {
                username: formData.get('username'),
                password: formData.get('password')
            };

            statusBar.querySelector('span').textContent = 'STATUS: VERIFYING';

            try {
                const resp = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!resp.ok) {
                    const errorData = await resp.json().catch(() => ({}));
                    if (errorData.error === 'ACCOUNT_DISABLED') {
                        throw new Error(errorData.message || '该账号不可用，请联系管理员');
                    }
                    throw new Error('用户名或密码错误');
                }

                const data = await resp.json();
                if (data.token) {
                    localStorage.setItem('tg_token', data.token);
                    
                    // 检查是否需要强制修改密码
                    if (data.mustChangePassword) {
                        localStorage.setItem('tg_must_change_password', 'true');
                        statusBar.querySelector('span').textContent = 'STATUS: REDIRECT_TO_PWD_CHANGE';
                        window.location.href = '/change-password.html';
                    } else {
                        localStorage.removeItem('tg_must_change_password');
                        statusBar.querySelector('span').textContent = 'STATUS: ACCEPTED';
                        window.location.href = '/home.html';
                    }
                } else {
                    throw new Error('登录响应异常');
                }
            } catch (err) {
                statusBar.querySelector('span').textContent = 'STATUS: DENIED';
                alert(err.message || '登录失败');
            }
        });
    </script>

</body>
</html>
