# 🎯 AWD-F 攻防模式比赛说明

## 📖 什么是 AWD-F？

**AWD-F（Attack with Defense - Full）** 是一种攻防兼备的 CTF 竞赛模式。与传统 Jeopardy 解题模式不同，AWD-F 要求参赛者既要 **攻击** 其他队伍的漏洞服务，又要 **防守** 自己的服务不被攻破。

---

## 🎮 比赛流程

### 1️⃣ 比赛开始 - 自动化容器部署
**⚡ 零等待启动**
- 比赛状态切换为"进行中"后，系统 **自动为所有队伍批量创建容器**
- 每支队伍都有 **预分配的固定端口**，避免端口冲突
- 所有容器在比赛开始时同步启动，公平竞争 🏁

**🔐 独立环境隔离**
- 每个队伍拥有完全独立的 Docker 容器环境
- 容器包含存在漏洞的 Web 应用
- 每个容器都配有 **16 位随机 SSH 密码**（大小写字母+数字+特殊符号）
- 容器生命周期自动管理：比赛结束时统一销毁

### 2️⃣ 攻击与防守 - 先攻后防

**🗡️ 攻击阶段（解锁防守权限）**
- 📌 **重要特性**：你必须 **先成功攻击一次**（提交正确 Flag），才能获得 SSH 防守权限！
- 利用漏洞攻击其他队伍的服务，获取他们的 Flag
- 提交 Flag 后获得 **攻击分** + 解锁本题的 **SSH 登录凭据**
- 首次解题的队伍获得 **首杀奖励分** 🏆

**🛡️ 防守阶段（SSH 加固）**
- 成功解题后，系统界面会显示你的容器 SSH 连接信息
- 通过 SSH 登录容器，修改源码修复漏洞
- 系统会定期运行 **EXP 攻击脚本** 和 **Check 功能检测脚本**
- 每轮判定结果：
  - ✅ **防御成功**：EXP 攻击失败 + 功能检测通过 → 获得 **防守分**
  - ❌ **被攻破**：EXP 攻击成功 → 失去防守分
  - ⚠️ **服务不可用**：功能检测失败 → 不得分

### 3️⃣ 轮次机制 - 全局倒计时
- 比赛采用 **统一防守间隔**（管理员可配置，如 60-300 秒）
- 每轮倒计时结束后，系统自动对所有队伍的容器执行攻防判定
- 实时排行榜更新，攻防大屏播报战况 📺

---

## 🏆 得分规则

| 得分项 | 说明 | 分值 |
|--------|------|------|
| 🎯 **攻击得分** | 成功攻破其他队伍服务，提交正确 Flag | +分（按题目难度） |
| 🛡️ **防守得分** | 自己的服务抵御住系统 EXP 攻击且功能正常 | +分（每轮固定） |
| ⚔️ **首次解题** | 首个完成题目的队伍 | 额外奖励分 |
| 💥 **服务宕机** | 服务不可用或功能检测失败 | 不得分 |

---

## 🔧 如何参赛

### 第一步：队伍审核
- 队伍报名后需等待管理员审核
- 审核通过后，系统会为你的队伍 **预分配专属端口**
- 比赛开始时，容器会自动使用这些端口启动 🚀

### 第二步：等待比赛开始
- ⏰ 比赛倒计时结束，状态切换为"进行中"
- 🤖 系统 **自动批量启动所有队伍的容器**（无需手动创建）
- 📡 启动过程可通过管理员日志监控

### 第三步：查看容器信息
1. **进入比赛页面**：点击比赛卡片进入题目列表
2. **查看容器状态**：题目界面显示容器信息
   - 🌐 **Web 访问地址**：`http://服务器IP:你的专属端口`
   - ⚠️ **SSH 登录信息**：初始状态为"未解锁"

### 第四步：攻击解题（解锁 SSH）
**⚔️ 攻击其他队伍**
- 访问其他队伍的 Web 服务（不同端口，相同漏洞）
- 利用漏洞获取 Flag：`TGCTF{...}`
- 在题目页面提交 Flag

**🔓 解锁防守权限**
- ✅ Flag 提交成功后，界面会显示 **绿色 SSH 信息框**
- 🔑 显示内容：
  ```
  🔓 SSH 防守通道已解锁
  攻击成功！现在可以通过 SSH 修复容器漏洞进行防守
  
  命令: ssh root@服务器IP -p 你的端口
  密码: Abc123!@#XyzDef$
  ```

### 第五步：SSH 防守加固
**🔍 登录容器审计代码**
```bash
# 复制界面显示的 SSH 命令（已包含正确的 IP 和端口）
ssh root@服务器IP -p 你的端口
# 输入界面显示的 16 位随机密码

# 查看源码（通常在 /var/www/html）
cd /var/www/html
ls -la
cat vuln.php
```

**🛠️ 修复漏洞**
```bash
# 编辑漏洞文件
vi vuln.php
# 或
nano vuln.php

# 修复后重启服务（根据容器配置）
service apache2 restart
# 或
service nginx restart
```

**⚠️ 修复注意事项**
- ✅ 可以添加过滤、白名单、参数校验
- ✅ 可以禁用危险函数（如 `system`、`eval`）
- ❌ **不要删除核心功能**，否则 Check 脚本检测失败！
- ❌ **不要让服务宕机**，否则无法得分

### 第六步：持续攻防
- 🔁 每轮倒计时结束后，系统自动判定攻防结果
- 📊 查看实时排行榜和得分变化
- 🔍 继续寻找其他队伍未修复的漏洞进行攻击
- 🛡️ 加固自己的防御，避免被其他队伍攻破

---

## ⚠️ 注意事项

### ✅ 允许的操作
- 修改源代码修复漏洞
- 添加防护措施（如 WAF、过滤）
- 重启服务
- 使用任何工具进行代码审计

### ❌ 禁止的操作
- 🚫 攻击比赛平台本身
- 🚫 攻击其他队伍的防守终端（仅限攻击漏洞服务）
- 🚫 使用 DDoS 等恶意攻击手段
- 🚫 破坏题目核心功能（导致检测失败）

---

## 📊 实时监控

比赛过程中可查看：
- 📈 **实时排行榜**：查看当前排名和分数
- 🎪 **攻防大屏**：实时播报攻击事件、防守成功、被攻破等
- 📉 **得分趋势**：查看自己和其他队伍的得分变化曲线

---

## 💡 新手提示

### 如何快速上手？
1. **先攻击**：⚠️ 必须先成功攻击一次才能获得 SSH 权限！
   - 比赛开始后立即访问自己的容器 Web 服务
   - 快速审计代码找到漏洞点
   - 用同样的方法攻击其他队伍，获取 Flag
2. **解锁 SSH**：提交 Flag 成功后，界面会显示 SSH 登录信息
3. **加固防守**：登录容器修复漏洞，等待下一轮判定
4. **持续攻防**：继续攻击其他队伍 + 加固自己的防御

### 常见漏洞类型
- 🐛 SQL 注入（SQLi）
- 🔓 命令注入（RCE）
- 📁 文件包含/上传
- 🔐 弱口令/认证绕过
- 🌐 XSS/CSRF

### 调试技巧
```bash
# 查看应用日志
tail -f /var/log/nginx/error.log
tail -f /var/log/apache2/error.log

# 查看进程
ps aux | grep php
ps aux | grep node

# 重启服务
service nginx restart
service apache2 restart
pm2 restart all
```

---

## 🎓 比赛心态

- 🧠 **攻防平衡**：不要只攻不守，也不要只守不攻
- ⏰ **时间管理**：合理分配攻击和防守的时间
- 🤝 **团队协作**：队内分工明确（攻击手/防守手）
- 📝 **记录经验**：记录发现的漏洞和修复方法

---

## 🆘 遇到问题？

### 容器相关
- **容器无法访问**：比赛可能未开始，或容器启动失败（联系管理员）
- **看不到 SSH 信息**：❗ 你还没有解题！必须先提交正确 Flag 才能解锁 SSH
- **SSH 连接失败**：
  - 确认已经成功解题（界面显示绿色解锁提示）
  - 复制界面显示的完整密码（16 位，含特殊符号）
  - 确认端口号正确（每个队伍的端口不同）
- **服务宕机**：检查修改是否导致 Apache/Nginx 崩溃，重启服务

### 得分相关
- **攻击得分**：确认 Flag 格式正确，且不是自己队伍的 Flag
- **防守不得分**：
  - 检查功能是否正常（Check 脚本检测）
  - 检查是否被 EXP 攻破（查看防守轮次结果）
- **首次解题没有首杀分**：可能其他队伍先提交了

### 端口和网络
- **不知道其他队伍的端口**：每个队伍的端口不同，需要扫描或枚举
- **预分配端口查看**：管理员可在队伍审核页面查看每队的端口列表

### 技术支持
如有任何疑问，请联系比赛管理员。

---

## 🎯 系统特色

### ⚡ 自动化部署
- 比赛开始时自动批量启动所有容器，公平竞争
- 预分配端口机制，避免端口冲突和资源竞争
- 容器生命周期自动管理（比赛结束自动销毁）

### 🔐 先攻后防机制
- 独特的"解题解锁 SSH"设计，确保队伍理解漏洞原理
- 攻击成功后才能防守，更符合真实攻防场景
- 每个容器独立 16 位随机密码，安全可靠

### 📊 实时监控与调度
- 全局统一倒计时，公平判定
- 实时攻防大屏播报（攻击成功、防守成功、被攻破）
- 并发判题支持，高性能处理

### 🛠️ 灵活管理
- 管理员可动态调整防守间隔
- 支持手动触发下一轮判定
- 队伍容器可重置（清除补丁，恢复初始状态）

---

## 🚀 准备好了吗？

**本系统的 AWD-F 模式** 融合了自动化部署、先攻后防、实时调度等特色功能，为你带来流畅的攻防对抗体验！

**祝你在比赛中取得好成绩！🏆**

---

*最后更新时间：2026-01*
